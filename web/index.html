<html>
	<head>
		<script>
			function clearOutput() {
				document.getElementById("output").innerHTML = "";
			}

			function runProgram() {
				clearOutput();

				const memory = new WebAssembly.Memory({ initial: 1 });

				const wasmImports = {
					imports: {
						imported_func: (arg) => {
							document.getElementById("output").innerHTML += `<p>${arg}</p>`;
						},
						printString: (location) => {
							const size = memory.buffer[location];
							const bytes = new Uint8Array(memory.buffer, location + 4, size);
							const string = new TextDecoder("utf8").decode(bytes);
							document.getElementById("output").innerHTML += `<p>${string}</p>`;
						},
						printNum: (num) => {
							document.getElementById("output").innerHTML += `<p>${num}</p>`
						}
					},
					js: {mem: memory}
				}

				WebAssembly.instantiateStreaming(fetch("./compiled.wasm"), wasmImports).then(
					(obj) => obj.instance.exports.main()
				);
			}
		</script>
	</head>
	<body>
		<h1>Lua WebAssembly</h1>
		<p>
			<button onclick="runProgram()">Run Program</button>
		</p>
		<p>
			<button onclick="clearOutput()">Clear Output</button>
		</p>

		<p>Output:</p>
		<div id="output">
			Test
		</div>
	</body>
</html>
